<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCut - Releases</title>
    <meta name="description" content="Download QCut AI Video Editor - Latest and Stable releases for Windows, macOS, and Linux." />
    <link rel="icon" type="image/png" href="assets/qcut-logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="lang/en.js"></script>
    <script src="lang/zh.js"></script>
    <script src="lang/ja.js"></script>
    <style>
        * { font-family: 'Inter', system-ui, sans-serif; }
        :root {
            --bg-primary: #faf9f7; --bg-secondary: #f0eeeb; --bg-card: #fff;
            --text-primary: #1a1a1a; --text-muted: #666; --text-light: #999;
            --border-color: #e5e5e5; --border-hover: #ccc;
        }
        .dark {
            --bg-primary: #0a0a0a; --bg-secondary: #111; --bg-card: #1a1a1a;
            --text-primary: #fff; --text-muted: #999; --text-light: #666;
            --border-color: #2a2a2a; --border-hover: #444;
        }
        body { background: var(--bg-primary); color: var(--text-primary); transition: background 0.3s, color 0.3s; }
        .bg-primary { background: var(--bg-primary); }
        .bg-secondary { background: var(--bg-secondary); }
        .bg-card { background: var(--bg-card); }
        .text-primary { color: var(--text-primary); }
        .text-muted { color: var(--text-muted); }
        .text-light { color: var(--text-light); }
        .border-main { border-color: var(--border-color); }
        .nav-border { border-bottom: 1px solid var(--border-color); }
        .theme-toggle { cursor: pointer; padding: 8px; border-radius: 8px; transition: background 0.2s; }
        .theme-toggle:hover { background: var(--bg-secondary); }
        .btn-dark { background: var(--text-primary); color: var(--bg-primary); transition: all 0.2s ease; }
        .btn-dark:hover { opacity: 0.8; }
        .btn-outline { border: 1px solid var(--border-color); background: transparent; color: var(--text-primary); transition: all 0.2s ease; }
        .btn-outline:hover { border-color: var(--text-muted); }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); transition: all 0.2s ease; }
        .card:hover { border-color: var(--border-hover); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        .badge-stable { background: #22c55e; color: #fff; }
        .badge-latest { background: #3b82f6; color: #fff; }
        .badge-prerelease { background: #f59e0b; color: #000; }
        .platform-icon { width: 20px; height: 20px; display: inline-block; vertical-align: middle; }
        .refresh-spin { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .skeleton { background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--border-color) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 8px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .auto-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: var(--bg-secondary); color: var(--text-muted); }
    </style>
</head>
<body class="antialiased">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-primary nav-border">
        <div class="max-w-5xl mx-auto px-6">
            <div class="flex items-center justify-between h-14">
                <div class="flex items-center space-x-8">
                    <a href="index.html" class="flex items-center space-x-2">
                        <img src="assets/qcut-logo.png" alt="QCut" class="h-7 w-7">
                        <span class="text-lg font-semibold">QCut</span>
                    </a>
                    <div class="hidden md:flex items-center space-x-6">
                        <a href="index.html#features" class="text-sm text-muted hover:text-primary transition-colors">Features</a>
                        <a href="index.html#ai" class="text-sm text-muted hover:text-primary transition-colors">AI Models</a>
                        <a href="releases.html" class="text-sm font-medium transition-colors" style="color: var(--text-primary);">Releases</a>
                        <a href="blog.html" class="text-sm text-muted hover:text-primary transition-colors">Docs</a>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleTheme()" class="theme-toggle" aria-label="Toggle theme">
                        <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-6 pt-24 pb-16">
        <!-- Header -->
        <div class="mb-10">
            <div class="flex items-center justify-between mb-2">
                <h1 class="text-3xl font-bold">Releases</h1>
                <div class="flex items-center gap-3">
                    <span class="auto-badge" id="auto-status">Auto-refresh: 5min</span>
                    <button onclick="fetchReleases()" id="refresh-btn" class="btn-outline rounded-lg px-3 py-1.5 text-sm flex items-center gap-2">
                        <svg id="refresh-icon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                        Refresh
                    </button>
                </div>
            </div>
            <p class="text-muted text-sm">Download QCut AI Video Editor for Windows, macOS, and Linux. Fetched live from <a href="https://github.com/donghaozhang/qcut/releases" target="_blank" class="underline hover:text-primary">GitHub</a>.</p>
            <p class="text-light text-xs mt-1" id="last-updated"></p>
        </div>

        <!-- Highlighted: Stable + Latest -->
        <div class="grid md:grid-cols-2 gap-4 mb-10" id="highlight-cards">
            <div class="skeleton h-48"></div>
            <div class="skeleton h-48"></div>
        </div>

        <!-- All Releases -->
        <h2 class="text-xl font-semibold mb-4">All Releases</h2>
        <div class="space-y-4" id="all-releases">
            <div class="skeleton h-24"></div>
            <div class="skeleton h-24"></div>
            <div class="skeleton h-24"></div>
        </div>
    </main>

    <footer class="border-t border-main py-8">
        <div class="max-w-5xl mx-auto px-6 text-center text-sm text-muted">
            Â© 2026 QCut by Quriosity. All rights reserved.
        </div>
    </footer>

<script>
const REPO = 'donghaozhang/qcut';
const API = `https://api.github.com/repos/${REPO}/releases`;
let autoRefreshInterval;

// === Theme ===
function toggleTheme() {
    document.body.classList.toggle('dark');
    localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
}
if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.body.classList.add('dark');
}

// === Helpers ===
function formatSize(bytes) {
    if (bytes > 1e9) return (bytes / 1e9).toFixed(1) + ' GB';
    if (bytes > 1e6) return (bytes / 1e6).toFixed(0) + ' MB';
    return (bytes / 1e3).toFixed(0) + ' KB';
}

function formatDate(dateStr) {
    const d = new Date(dateStr);
    return d.toLocaleDateString('en-AU', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
}

function timeAgo(dateStr) {
    const diff = Date.now() - new Date(dateStr).getTime();
    const mins = Math.floor(diff / 60000);
    if (mins < 60) return `${mins}m ago`;
    const hrs = Math.floor(mins / 60);
    if (hrs < 24) return `${hrs}h ago`;
    return `${Math.floor(hrs / 24)}d ago`;
}

const platformIcons = {
    windows: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M3 12V6.5l7-1V12H3zm0 .5h7v6.5l-7-1V12.5zM10.5 5.4L21 3.5V12H10.5V5.4zM10.5 12.5H21v8.5l-10.5-1.9V12.5z"/></svg>',
    mac: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.8-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>',
    linux: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12.504 0c-.155 0-.315.008-.48.021-4.226.333-3.105 4.807-3.17 6.298-.076 1.092-.3 1.953-1.05 3.02-.885 1.051-2.127 2.75-2.716 4.521-.278.832-.41 1.684-.287 2.489a.424.424 0 00-.11.135c-.26.268-.45.6-.663.839-.199.199-.485.267-.797.4-.313.136-.658.269-.864.68-.09.189-.136.394-.132.602 0 .199.027.4.055.536.058.399.116.728.04.97-.249.68-.28 1.145-.106 1.484.174.334.535.47.94.601.81.2 1.91.135 2.774.6.926.466 1.866.67 2.616.47.526-.116.97-.464 1.208-.946.587-.003 1.23-.269 2.26-.334.699-.04 1.241.029 1.703.166.27.084.479.212.69.345.21.138.426.218.627.221.127.003.254-.035.432-.098.477-.168.938-.595 1.22-.975.369-.404.625-.905.754-1.273.023-.065.043-.133.046-.198.107-.467.253-.752.398-1.16.122-.34.241-.675.283-1.069.049-.4.02-.822-.093-1.333a2.545 2.545 0 00-.233-.656c.009-.021.015-.043.024-.064a5.07 5.07 0 001.243-2.685c.238-1.372-.116-2.72-.626-3.869-.525-1.181-1.22-2.208-1.727-3.003C15.8 4.827 14.928.99 12.504 0zm.28 2.012c.076-.003.154-.002.23 0 1.3.076 1.903 2.324 2.48 3.63.58 1.31 1.236 2.428 1.702 3.445.477 1.044.771 2.105.553 3.246a4.06 4.06 0 01-.94 2.023c-.337-.274-.63-.66-.926-.87a3.342 3.342 0 00-1.19-.533c-.345-.09-.725-.1-1.155-.072-1.028.064-1.702.335-2.346.338-.069-.002-.217.013-.32.006a1.76 1.76 0 01-.157-.014c-.222.005-.455-.026-.697-.098a3.292 3.292 0 01-.908-.416 6.035 6.035 0 01-.654-.483c.043-.234.073-.518.038-.867-.106-.853-.415-1.464-.782-2.075-.37-.618-.79-1.237-1.078-2.046-.252-.64-.381-1.374-.25-2.283.098-.6.43-1.608 1.178-2.376.85-.85 1.44-.82 2.014-.879a4.52 4.52 0 011.26.07c.38.07.746.217 1.088.404.328.175.617.433.916.644.09.064.17.131.252.198.084-.118.18-.229.28-.333.226-.35.436-.567.636-.774.32-.261.607-.498.983-.66a2.316 2.316 0 011.013-.215z"/></svg>'
};

function getPlatform(name) {
    if (name.endsWith('.exe')) return { icon: platformIcons.windows, label: 'Windows', os: 'windows' };
    if (name.endsWith('.dmg')) return { icon: platformIcons.mac, label: 'macOS', os: 'mac' };
    if (name.endsWith('.AppImage')) return { icon: platformIcons.linux, label: 'Linux', os: 'linux' };
    if (name.endsWith('.deb')) return { icon: platformIcons.linux, label: 'Linux (deb)', os: 'linux' };
    if (name.endsWith('.zip') && name.includes('mac')) return { icon: platformIcons.mac, label: 'macOS (zip)', os: 'mac' };
    return null;
}

function filterAssets(assets) {
    return assets.filter(a => {
        const n = a.name.toLowerCase();
        return !n.endsWith('.yml') && !n.endsWith('.blockmap') && !n.endsWith('.txt') &&
               !n.startsWith('builder-') && !n.includes('SHA256');
    }).filter(a => {
        // Deduplicate: prefer "QCut-AI-Video-Editor-" prefix over "QCut.AI.Video.Editor-"
        if (a.name.includes('.AI.Video.Editor')) {
            const alt = a.name.replace('QCut.AI.Video.Editor', 'QCut-AI-Video-Editor');
            return !assets.some(b => b.name === alt);
        }
        return true;
    });
}

function badgeHTML(release) {
    if (release.prerelease) return '<span class="badge-prerelease text-xs font-semibold px-2 py-0.5 rounded-full">Pre-release</span>';
    return '<span class="badge-stable text-xs font-semibold px-2 py-0.5 rounded-full">Stable</span>';
}

function assetRowHTML(asset) {
    const p = getPlatform(asset.name);
    if (!p) return '';
    return `
        <a href="${asset.browser_download_url}" class="flex items-center justify-between py-2 px-3 rounded-lg hover:bg-secondary transition-colors group">
            <div class="flex items-center gap-3">
                <span class="text-muted">${p.icon}</span>
                <div>
                    <div class="text-sm font-medium">${p.label}</div>
                    <div class="text-xs text-light">${asset.name}</div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <span class="text-xs text-muted">${formatSize(asset.size)}</span>
                <svg class="w-4 h-4 text-muted group-hover:text-primary transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
            </div>
        </a>`;
}

function highlightCard(release, label, colorClass) {
    const assets = filterAssets(release.assets);
    return `
        <div class="card rounded-xl p-6">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <span class="${colorClass} text-xs font-semibold px-2.5 py-1 rounded-full">${label}</span>
                    <span class="text-lg font-semibold">${release.tag_name}</span>
                </div>
                <span class="text-xs text-muted">${timeAgo(release.published_at)}</span>
            </div>
            <p class="text-sm text-muted mb-4">${release.name || release.tag_name}</p>
            <div class="space-y-1">
                ${assets.map(a => assetRowHTML(a)).join('')}
            </div>
            <div class="mt-3 pt-3 border-t border-main">
                <a href="${release.html_url}" target="_blank" class="text-xs text-muted hover:text-primary transition-colors">View on GitHub â†’</a>
            </div>
        </div>`;
}

function releaseRow(release) {
    const assets = filterAssets(release.assets);
    const platforms = [...new Set(assets.map(a => getPlatform(a.name)).filter(Boolean).map(p => p.icon))].join('');
    return `
        <details class="card rounded-xl overflow-hidden">
            <summary class="px-6 py-4 cursor-pointer flex items-center justify-between hover:bg-secondary transition-colors">
                <div class="flex items-center gap-3">
                    ${badgeHTML(release)}
                    <span class="font-semibold">${release.tag_name}</span>
                    <span class="text-sm text-muted">${release.name || ''}</span>
                </div>
                <div class="flex items-center gap-3">
                    <span class="flex items-center gap-1 text-muted">${platforms}</span>
                    <span class="text-xs text-muted">${formatDate(release.published_at)}</span>
                    <svg class="w-4 h-4 text-muted transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
            </summary>
            <div class="px-6 pb-4 space-y-1 border-t border-main pt-3">
                ${assets.map(a => assetRowHTML(a)).join('')}
                <div class="pt-2"><a href="${release.html_url}" target="_blank" class="text-xs text-muted hover:text-primary">View on GitHub â†’</a></div>
            </div>
        </details>`;
}

// === Fetch ===
async function fetchReleases() {
    const icon = document.getElementById('refresh-icon');
    icon.classList.add('refresh-spin');

    try {
        const res = await fetch(API, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
        const releases = await res.json();

        // Separate stable vs prerelease
        const stable = releases.filter(r => !r.prerelease && !r.draft);
        const prerelease = releases.filter(r => r.prerelease && !r.draft);

        const latest = stable[0];
        const latestPre = prerelease[0];

        // Highlight cards: Stable + Latest (newest regardless of prerelease status)
        const highlightEl = document.getElementById('highlight-cards');
        const allNonDraft = releases.filter(r => !r.draft);
        const newest = allNonDraft[0]; // latest release (could be prerelease)
        let cards = '';
        if (latest) cards += highlightCard(latest, 'âœ… Stable Release', 'badge-stable');
        if (newest && newest !== latest) cards += highlightCard(newest, 'ðŸš€ Latest Release', 'badge-latest');
        highlightEl.innerHTML = cards;

        // All releases â€” only recent 10
        const allEl = document.getElementById('all-releases');
        allEl.innerHTML = allNonDraft.slice(0, 10).map(r => releaseRow(r)).join('');

        document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
    } catch (err) {
        console.error('Failed to fetch releases:', err);
        document.getElementById('highlight-cards').innerHTML = `<div class="card rounded-xl p-6 col-span-2 text-center text-muted">Failed to load releases. <button onclick="fetchReleases()" class="underline">Retry</button></div>`;
    }

    icon.classList.remove('refresh-spin');
}

// Init
fetchReleases();
autoRefreshInterval = setInterval(fetchReleases, 5 * 60 * 1000); // 5 min auto-refresh
</script>
</body>
</html>
